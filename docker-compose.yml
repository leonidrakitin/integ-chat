services:
  app:
    build: .
    container_name: chatwoot-messenger-gateway
    restart: always
    ports:
      - "3000:3000"
    environment:
      # Основные настройки
      - PORT=3000
      - REDIS_URL=redis://redis:6379

      # Chatwoot API credentials
      - CHATWOOT_API_ACCESS_TOKEN=${CHATWOOT_API_ACCESS_TOKEN}
      - CHATWOOT_ACCOUNT_ID=${CHATWOOT_ACCOUNT_ID}
      - CHATWOOT_BASE_URL=${CHATWOOT_BASE_URL}

      # Chatwoot per-channel webhooks
      - CHATWOOT_WEBHOOK_ID_WHATSAPP=${CHATWOOT_WEBHOOK_ID_WHATSAPP}
      - CHATWOOT_WEBHOOK_ID_TELEGRAM=${CHATWOOT_WEBHOOK_ID_TELEGRAM}
      - CHATWOOT_WEBHOOK_ID_VK=${CHATWOOT_WEBHOOK_ID_VK}

      # Wasender API credentials
      - WASENDER_API_KEY=${WASENDER_API_KEY}
      - WASENDER_WEBHOOK_SECRET=${WASENDER_WEBHOOK_SECRET}
      - WASENDER_WEBHOOK_ID=${WASENDER_WEBHOOK_ID}
      - WASENDER_INBOX_ID=${WASENDER_INBOX_ID}

      # Telegram API credentials
      - TG_API_ID=${TG_API_ID}
      - TG_API_HASH=${TG_API_HASH}
      - TG_SESSION_NAME=${TG_SESSION_NAME}
      - TG_INBOX_ID=${TG_INBOX_ID}

      # VK group bot
      - VK_ACCESS_TOKEN=${VK_ACCESS_TOKEN}
      - VK_GROUP_ID=${VK_GROUP_ID}
      - VK_SECRET=${VK_SECRET}
      - VK_CONFIRMATION=${VK_CONFIRMATION}
      - VK_API_VERSION=${VK_API_VERSION}
      - VK_CALLBACK_ID=${VK_CALLBACK_ID}
      - VK_INBOX_ID=${VK_INBOX_ID}
    depends_on:
      - redis

  redis:
    image: redis:7-alpine
    container_name: messenger-gateway-redis
    restart: always
    volumes:
      - redis_data:/data

volumes:
  redis_data:
